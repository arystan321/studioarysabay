"use client";

import { useState } from "react";
import { Button } from "@/components/ui/button";
import {
  Card,
  CardContent,
  CardDescription,
  CardFooter,
  CardHeader,
  CardTitle,
} from "@/components/ui/card";
import { Input } from "@/components/ui/input";
import { Label } from "@/components/ui/label";
import { BookOpen, Sparkles } from "lucide-react";

// üìÑ –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ –∏–∑ PDF
const extractTextFromPDF = async (file: File): Promise<string> => {
  const pdfjsLib = await import("pdfjs-dist/webpack");
  const pdf = await pdfjsLib.getDocument(await file.arrayBuffer()).promise;
  let text = "";

  for (let i = 1; i <= pdf.numPages; i++) {
    const page = await pdf.getPage(i);
    const content = await page.getTextContent();
    text += content.items.map((item: any) => item.str).join(" ");
  }
  return text;
};

// üî¨ –ü—Ä–∏–º–µ—Ä –∞–Ω–∞–ª–∏–∑–∞ —Å—Ç–∞—Ç—å–∏ —Å –ø–æ–º–æ—â—å—é OpenAI –∏–ª–∏ Gemini API
// (—Ç—É—Ç —Ç—ã –º–æ–∂–µ—à—å –≤—Å—Ç–∞–≤–∏—Ç—å —Å–≤–æ–π –∫–ª—é—á –∏ —Ä–µ–∞–ª—å–Ω—ã–π –∑–∞–ø—Ä–æ—Å –∫ API)
async function analyzeScientificArticle(text: string): Promise<string> {
  // –î–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ –º—ã –ø—Ä–æ—Å—Ç–æ –∏–º–∏—Ç–∏—Ä—É–µ–º –∞–Ω–∞–ª–∏–∑:
  const summary = `
# üß† –ü–æ–¥—Ä–æ–±–Ω—ã–π –∞–Ω–∞–ª–∏–∑ —Å—Ç–∞—Ç—å–∏

## 1. –û–±—â–∏–µ —Å–≤–µ–¥–µ–Ω–∏—è
–°—Ç–∞—Ç—å—è —Å–æ–¥–µ—Ä–∂–∏—Ç ${Math.round(text.length / 1000)} —Ç—ã—Å—è—á —Å–∏–º–≤–æ–ª–æ–≤ —Ç–µ–∫—Å—Ç–∞. 
–û—Å–Ω–æ–≤–Ω–∞—è —Ç–µ–º–∞—Ç–∏–∫–∞ ‚Äî —Å–æ–∑–¥–∞–Ω–∏–µ –Ω–∞—É—á–Ω–æ–≥–æ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞ –∏–ª–∏ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ –≤ –ø—Ä–∏–∫–ª–∞–¥–Ω–æ–π –æ–±–ª–∞—Å—Ç–∏. 
–†–∞–±–æ—Ç–∞ –≤–∫–ª—é—á–∞–µ—Ç –≤–≤–µ–¥–µ–Ω–∏–µ, –æ–ø–∏—Å–∞–Ω–∏–µ –º–µ—Ç–æ–¥–æ–ª–æ–≥–∏–∏, —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –∏ –≤—ã–≤–æ–¥—ã, —á—Ç–æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä–µ –Ω–∞—É—á–Ω–æ–π –ø—É–±–ª–∏–∫–∞—Ü–∏–∏.

## 2. –û—Ü–µ–Ω–∫–∞ –Ω–∞—É—á–Ω–æ—Å—Ç–∏
–¢–µ–∫—Å—Ç –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç –ø—Ä–∏–∑–Ω–∞–∫–∏ –∞–∫–∞–¥–µ–º–∏—á–µ—Å–∫–æ–≥–æ —Å—Ç–∏–ª—è:
- –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ç–µ—Ä–º–∏–Ω–æ–≤ –∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–π,
- –Ω–∞–ª–∏—á–∏–µ —Å—Å—ã–ª–æ–∫ –Ω–∞ –∏—Å—Ç–æ—á–Ω–∏–∫–∏,
- —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ—Å—Ç—å –∏–∑–ª–æ–∂–µ–Ω–∏—è.

–¢–µ–º –Ω–µ –º–µ–Ω–µ–µ, –≤—Å—Ç—Ä–µ—á–∞—é—Ç—Å—è —ç–ª–µ–º–µ–Ω—Ç—ã –æ–ø–∏—Å–∞—Ç–µ–ª—å–Ω–æ–≥–æ –ø–æ–≤–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è, –Ω–µ –≤—Å–µ–≥–¥–∞ –ø–æ–¥–∫—Ä–µ–ø–ª—ë–Ω–Ω—ã–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏. 
–ù–∞—É—á–Ω–∞—è —Å—Ç—Ä–æ–≥–æ—Å—Ç—å –æ—Ü–µ–Ω–µ–Ω–∞ –∫–∞–∫ **7/10** ‚Äî —Ö–æ—Ä–æ—à–∞—è, –Ω–æ —Ç—Ä–µ–±—É–µ—Ç —É—Å–∏–ª–µ–Ω–∏—è –æ–±–æ—Å–Ω–æ–≤–∞–Ω–∏–π –∏ —Ü–∏—Ç–∏—Ä–æ–≤–∞–Ω–∏—è.

## 3. –ú–µ—Ç–æ–¥–æ–ª–æ–≥–∏—á–µ—Å–∫–∞—è —á–∞—Å—Ç—å
–ú–µ—Ç–æ–¥—ã –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è –æ–ø–∏—Å–∞–Ω—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ, –æ–¥–Ω–∞–∫–æ –Ω–µ –≤—Å–µ–≥–¥–∞ —É–∫–∞–∑–∞–Ω—ã –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–æ–≤. 
–°–ª–µ–¥—É–µ—Ç –¥–æ–±–∞–≤–∏—Ç—å:
- —Ç–æ—á–Ω—ã–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Ä–∞–∑–º–µ—Ä—ã –≤—ã–±–æ—Ä–∫–∏, –ø–æ—Ä–æ–≥–∏ —Ç–æ—á–Ω–æ—Å—Ç–∏);
- –¥–∏–∞–≥—Ä–∞–º–º—ã –∏ —Ç–∞–±–ª–∏—Ü—ã –¥–ª—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤;
- –æ–ø–∏—Å–∞–Ω–∏–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π –º–µ—Ç–æ–¥–∞.

## 4. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å—Ç–∞—Ç—å–∏
- **–í–≤–µ–¥–µ–Ω–∏–µ**: —è—Å–Ω–æ –æ–±–æ–∑–Ω–∞—á–∞–µ—Ç —Ç–µ–º—É –∏ —Ü–µ–ª—å –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è.
- **–ú–µ—Ç–æ–¥—ã**: –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω—ã –æ–±—â–∏–º–∏ —Å–ª–æ–≤–∞–º–∏, –±–µ–∑ –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞.
- **–†–µ–∑—É–ª—å—Ç–∞—Ç—ã**: –µ—Å—Ç—å –≥—Ä–∞—Ñ–∏–∫–∏, –Ω–æ –Ω–µ –≤—Å–µ–≥–¥–∞ –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∏—Ä—É—é—Ç—Å—è.
- **–û–±—Å—É–∂–¥–µ–Ω–∏–µ**: —Ç—Ä–µ–±—É–µ—Ç —Å–≤—è–∑–∏ —Å –º–∏—Ä–æ–≤–æ–π –Ω–∞—É—á–Ω–æ–π –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä–æ–π.
- **–í—ã–≤–æ–¥—ã**: –∫—Ä–∞—Ç–∫–∏–µ, –Ω–æ –Ω–µ –æ—Ç—Ä–∞–∂–∞—é—Ç –≤—Å–µ–≥–æ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª–∞ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è.

## 5. –õ–∏–Ω–≥–≤–∏—Å—Ç–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑
–°—Ç–∏–ª—å –≤ —Ü–µ–ª–æ–º –Ω–∞—É—á–Ω—ã–π, –æ–¥–Ω–∞–∫–æ –≤—Å—Ç—Ä–µ—á–∞—é—Ç—Å—è —Ñ—Ä–∞–∑—ã —Ä–∞–∑–≥–æ–≤–æ—Ä–Ω–æ–≥–æ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∞ –∏ –ø–æ–≤—Ç–æ—Ä—ã.
–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è:
- —É–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å —Ç–µ—Ä–º–∏–Ω—ã;
- –∑–∞–º–µ–Ω–∏—Ç—å –Ω–µ—Ñ–æ—Ä–º–∞–ª—å–Ω—ã–µ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏;
- –¥–æ–±–∞–≤–∏—Ç—å –ø–µ—Ä–µ—Ö–æ–¥–Ω—ã–µ —Ñ—Ä–∞–∑—ã –º–µ–∂–¥—É —Ä–∞–∑–¥–µ–ª–∞–º–∏.

## 6. –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª –ø—É–±–ª–∏–∫–∞—Ü–∏–∏
–†–∞–±–æ—Ç–∞ –∏–º–µ–µ—Ç –≤—ã—Å–æ–∫–∏–π –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª –¥–ª—è –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ –≤ –∂—É—Ä–Ω–∞–ª–∞—Ö —É—Ä–æ–≤–Ω—è **Scopus Q3‚ÄìQ4**, –ø—Ä–∏ —É—Å–ª–æ–≤–∏–∏:
- –¥–æ—Ä–∞–±–æ—Ç–∫–∏ –º–µ—Ç–æ–¥–æ–ª–æ–≥–∏–∏;
- —É—Ç–æ—á–Ω–µ–Ω–∏—è —Ñ–æ—Ä–º—É–ª –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤;
- –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å—Å—ã–ª–æ–∫ –ø–æ —Å—Ç–∏–ª—é APA/IEEE.

## 7. –í–æ–∑–º–æ–∂–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è
1. –î–æ–±–∞–≤–∏—Ç—å —Å—Å—ã–ª–∫–∏ –Ω–∞ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏ (–ø–æ—Å–ª–µ–¥–Ω–∏–µ 5 –ª–µ—Ç).
2. –†–∞—Å—à–∏—Ä–∏—Ç—å —Ä–∞–∑–¥–µ–ª —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏.
3. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ ‚Äî –≥—Ä–∞—Ñ–∏–∫–∏, –¥–∏–∞–≥—Ä–∞–º–º—ã, —Ç–∞–±–ª–∏—Ü—ã.
4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∞–Ω–Ω–æ—Ç–∞—Ü–∏—é ‚Äî –æ–Ω–∞ –¥–æ–ª–∂–Ω–∞ –æ—Ç—Ä–∞–∂–∞—Ç—å —Ü–µ–ª—å, –º–µ—Ç–æ–¥—ã, —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –∏ –≤—ã–≤–æ–¥—ã.
5. –£–∫–∞–∑–∞—Ç—å –Ω–∞—É—á–Ω—É—é –Ω–æ–≤–∏–∑–Ω—É –∏ –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫—É—é –∑–Ω–∞—á–∏–º–æ—Å—Ç—å.

## 8. –ó–∞–∫–ª—é—á–µ–Ω–∏–µ
–í —Ü–µ–ª–æ–º, —Å—Ç–∞—Ç—å—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç –≤—ã—Å–æ–∫–∏–π —É—Ä–æ–≤–µ–Ω—å –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ –∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –∞–∫–∞–¥–µ–º–∏—á–µ—Å–∫–∏–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∞–º, 
–æ–¥–Ω–∞–∫–æ –Ω—É–∂–¥–∞–µ—Ç—Å—è –≤ —É–≥–ª—É–±–ª–µ–Ω–∏–∏ –º–µ—Ç–æ–¥–æ–ª–æ–≥–∏—á–µ—Å–∫–æ–π –±–∞–∑—ã –∏ —É–ª—É—á—à–µ–Ω–∏–∏ —Å—Ç–∏–ª—è –∏–∑–ª–æ–∂–µ–Ω–∏—è. 
–ü–æ—Å–ª–µ –ø—Ä–∞–≤–æ–∫ –º–æ–∂–µ—Ç –±—ã—Ç—å —Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–∞ –¥–ª—è –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ –≤ —Ä–µ—Ü–µ–Ω–∑–∏—Ä—É–µ–º–æ–º –∏–∑–¥–∞–Ω–∏–∏.

---

üß© **–û–±—â–∏–π –≤—ã–≤–æ–¥**: —Ä–∞–±–æ—Ç–∞ –Ω–∞—É—á–Ω–∞—è, —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–∞—è, –ø–µ—Ä—Å–ø–µ–∫—Ç–∏–≤–Ω–∞—è.  
**–û—Ü–µ–Ω–∫–∞ –Ω–∞—É—á–Ω–æ–≥–æ —É—Ä–æ–≤–Ω—è: 8.2 / 10**.
`;
  return summary;
}

// ---------------------- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç ----------------------

export function QuizCreator() {
  const [file, setFile] = useState<File | null>(null);
  const [analysis, setAnalysis] = useState<string>("");
  const [loading, setLoading] = useState(false);

  const handleAnalyzePDF = async () => {
    if (!file) {
      alert("Please select a PDF file first!");
      return;
    }

    try {
      setLoading(true);
      setAnalysis("‚è≥ Extracting text and analyzing, please wait...");

      const text = await extractTextFromPDF(file);
      const result = await analyzeScientificArticle(text);
      setAnalysis(result);
    } catch (err) {
      console.error("Error analyzing PDF:", err);
      setAnalysis("‚ùå Error during analysis. Please try again.");
    } finally {
      setLoading(false);
    }
  };

  return (
    <Card className="w-full max-w-3xl mx-auto mt-6">
      <CardHeader className="text-center">
        <div className="mx-auto bg-primary rounded-full p-3 w-fit mb-2">
          <BookOpen className="h-8 w-8 text-primary-foreground" />
        </div>
        <CardTitle className="font-headline text-3xl">
          Scientific Article Analyzer
        </CardTitle>
        <CardDescription>
          Upload a scientific article in PDF format to get a detailed analysis of
          its structure, content, and scientific value.
        </CardDescription>
      </CardHeader>

      <CardContent className="space-y-6">
        <div className="space-y-2">
          <Label htmlFor="file">Upload a PDF</Label>
          <Input
            id="file"
            name="file"
            type="file"
            accept=".pdf"
            onChange={(e) => setFile(e.target.files?.[0] || null)}
          />
          <Button
            type="button"
            onClick={handleAnalyzePDF}
            disabled={loading}
            className="mt-3 w-full"
          >
            <Sparkles className="mr-2 h-4 w-4" />
            {loading ? "Analyzing..." : "Analyze PDF"}
          </Button>
        </div>

        {analysis && (
          <div className="p-4 bg-muted rounded-lg whitespace-pre-wrap text-left overflow-y-auto max-h-[600px] text-sm">
            {analysis}
          </div>
        )}
      </CardContent>

      <CardFooter className="text-center text-muted-foreground">
        This tool helps assess academic writing and structure quality.
      </CardFooter>
    </Card>
  );
}